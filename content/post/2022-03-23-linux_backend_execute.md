---
title: "linux后台执行可用方式整理"
date: 2022-03-23T00:29:47+08:00
tag : [ "linux", "backend_execute" ]
description: "linux后台执行可用方式整理"
categories: [ "linux", "backend_execute" ]
toc: true
---

## 前言
最近答疑群友如何后台运行 ssh 连接后的操作，整理了下日常常见的后台执行方式，方便知识梳理。

## 1、nohup方式
```bash
# nohup sh shell.sh &
查看日志：tail -f nohup.out
```

## 2、disown方式
```bash
# sh shell.sh & disown
查看日志：断开终端后，不能再查看日志
```

## 3、screen方式
执行screen，如果命令不存在，需要先安装：
```bash
# yum install screen -y
```
新建一个屏幕：
```bash
# screen -S screen_name
```
执行命令：
```bash
# sh shell.sh
```
依次按 Ctrl+A 与 D (无 Ctrl) 脱离该屏幕，此时程序仍运行在后台。

如果希望查看日志或结束程序，你可以随时通过下面命令重新连接到该屏幕进行操作。
```bash
# screen -d -r screen_name
```
可以用命令查看当前存在的所有屏幕。
```bash
# screen -ls
```

screen常用命令
你可能注意到给screen发送命令使用了特殊的键组合C-a。这是因为我们在键盘上键入的信息是直接发送给当前screen窗口，必须用其他方式向screen窗口管理器发出命令，默认情况下，screen接收以C-a开始的命令。这种命令形式在screen中叫做键绑定（key binding），C-a叫做命令字符（command character）。

可以通过C-a ?来查看所有的键绑定，常用的键绑定有：
快捷键|说明
-|-
C-a ?|显示所有键绑定信息
C-a w|显示所有窗口列表
C-a C-a|切换到之前显示的窗口
C-a c|创建一个新的运行shell的窗口并切换到该窗口
C-a n|切换到下一个窗口
C-a p|切换到前一个窗口(与C-a n相对)
C-a 0..9|切换到窗口0..9
C-a a|发送 C-a到当前窗口
C-a d|暂时断开screen会话
C-a k|杀掉当前窗口
C-a [|进入拷贝/回滚模式

## 4、tmux方式
Tmux是一个优秀的终端复用软件，类似GNU Screen，但来自于OpenBSD，采用BSD授权。  
使用它最直观的好处就是，通过一个终端登录远程主机并运行tmux后，在其中可以开启多个控制台而无需再“浪费”多余的终端来连接这台远程主机；  
是BSD实现的Screen替代品，相对于Screen，它更加先进：  
支持屏幕切分，而且具备丰富的命令行参数，使其可以灵活、动态的进行各种布局和操作。

下面就Tmux的使用做一梳理：
### 4.1 Tmux功能：
- 提供了强劲的、易于使用的命令行界面。
- 可横向和纵向分割窗口。
- 窗格可以自由移动和调整大小，或直接利用四个预设布局之一。
- 支持 UTF-8 编码及 256 色终端。
- 可在多个缓冲区进行复制和粘贴。
- 可通过交互式菜单来选择窗口、会话及客户端。
- 支持跨窗口搜索。
- 支持自动及手动锁定窗口。

Tmux安装
ubuntu版本下直接apt-get安装
```bash
# sudo apt-get install tmux
```
centos7版本下直接yum安装
```bash
# yum install -y tmux
```
centos6版本需要编译安装  
tmux官网下载地址：http://tmux.github.io/

Tmux的使用
安装完成后输入命令tmux即可打开软件，界面十分简单，类似一个下方带有状态栏的终端控制台；  
但根据tmux的定义，在开启了tmux服务器后，会首先创建一个会话，而这个会话则会首先创建一个窗口，其中仅包含一个面板；  
也就是说，这里看到的所谓终端控制台应该称作tmux的一个面板，虽然其使用方法与终端控制台完全相同。
```bash
# tmux
```                                   
Tmux的快捷键使用说明：
快捷键|说明
-|-
Ctrl+b|激活控制台；此时以下按键生效
?|列出所有快捷键；按q返回
d|脱离当前会话；这样可以暂时返回Shell界面，输入tmux attach能够重新进入之前的会话
D|选择要脱离的会话；在同时开启了多个会话时使用
Ctrl+z|挂起当前会话
r|强制重绘未脱离的会话
s|选择并切换会话；在同时开启了多个会话时使用
:|进入命令行模式；此时可以输入支持的命令，例如kill-server可以关闭服务器
[|进入复制模式；此时的操作与vi/emacs相同，按q/Esc退出
~|列出提示信息缓存；其中包含了之前tmux返回的各种提示信息
c|创建新窗口
&|关闭当前窗口
数字键|切换至指定窗口
p|切换至上一窗口
n|切换至下一窗口
l|在前后两个窗口间互相切换
w|通过窗口列表切换窗口
,|重命名当前窗口；这样便于识别
.|修改当前窗口编号；相当于窗口重新排序
f|在所有窗口中查找指定文本
”|将当前面板平分为上下两块
%|将当前面板平分为左右两块
x|关闭当前面板
!|将当前面板置于新窗口；即新建一个窗口，其中仅包含当前面板
Ctrl+方向键|以1个单元格为单位移动边缘以调整当前面板大小
Alt+方向键|以5个单元格为单位移动边缘以调整当前面板大小
Space|在预置的面板布局中循环切换；依次包括even-horizontal、even-vertical、main-horizontal、main-vertical、tiled
q|显示面板编号
o|在当前窗口中选择下一面板
方向键|移动光标以选择面板
{|向前置换当前面板
}|向后置换当前面板
Alt+o|逆时针旋转当前窗口的面板
Ctrl+o|顺时针旋转当前窗口的面板

需要注意的几点：   
进入tmux面板后，一定要先按ctrl+b，然后松开，再按其他的组合键才生效。  
常用到的几个组合键：
快捷键|说明
-|-
ctrl+b ?|显示快捷键帮助
ctrl+b 空格键|采用下一个内置布局，这个很有意思，在多屏时，用这个就会将多有屏幕竖着展示
ctrl+b !|把当前窗口变为新窗口
ctrl+b “|模向分隔窗口
ctrl+b %|纵向分隔窗口
ctrl+b q|显示分隔窗口的编号
ctrl+b o|跳到下一个分隔窗口。多屏之间的切换
ctrl+b 上下键|上一个及下一个分隔窗口
ctrl+b C-方向键|调整分隔窗口大小
ctrl+b &|确认后退出当前tmux
ctrl+b [|复制模式，即将当前屏幕移到上一个的位置上，其他所有窗口都向前移动一个。
ctrl+b c|创建新窗口
ctrl+b n|选择下一个窗口
ctrl+b l|最后使用的窗口
ctrl+b p|选择前一个窗口
ctrl+b w|以菜单方式显示及选择窗口
ctrl+b s|以菜单方式显示和选择会话。这个常用到，可以选择进入哪个tmux
ctrl+b t|显示时钟。然后按enter键后就会恢复到shell终端状态
ctrl+b d|脱离当前会话；这样可以暂时返回Shell界面，输入tmux attach能够重新进入之前的会话

## 5、jobs方式
1 jobs查看已挂载的程序,不用携带任何参数  
```bash
jobs
```
2 jobs杀死后台已经禁止的程序
```bash
kill %num
ps 查看所有进程
kill num杀死后台进程
```
3 fg 将后台停止的进程调至前台继续运行  
使用 jobs 查看那些程序停止了
```bash
fg %num
```
4 bg 将后台停止的进程在后台继续运行
```bash
bg %num
```